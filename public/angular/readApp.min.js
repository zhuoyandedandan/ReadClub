(function(){angular.module("readApp",["ngRoute","ngSanitize","ui.bootstrap"]);function o(o,t){o.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"about/about.html",controller:"aboutCtrl",caseInsensitiveMatch:true,controllerAs:"vm"}).when("/books",{templateUrl:"books/books.html",controller:"booksCtrl",caseInsensitiveMatch:true,controllerAs:"vm"}).when("/book/:bookid",{templateUrl:"bookDetail/bookDetail.html",controller:"bookDetailCtrl",caseInsensitiveMatch:true,controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true)}angular.module("readApp").config(["$routeProvider","$locationProvider",o])})();angular.module("readApp").controller("homeCtrl",homeCtrl);homeCtrl.$inject=["topicData","userData"];function homeCtrl(o,t){var e=this;e.message="loading...";o.success(function(o){e.message=o.length>0?"":"暂无数据";e.data=o}).error(function(o){console.log(o);e.message="Sorry, something's gone wrong "});e.user=t}angular.module("readApp").service("topicData",topicData).service("booksData",booksData).service("userData",userData);topicData.$inject=["$http"];function topicData(o){return o.get("/api/topics")}booksData.$inject=["$http"];function booksData(o){var t=o.get("/api/books");var e=function(t){return o.get("/api/book/"+t)};var r=function(t){return o.post("/api/book",t)};var n=function(t){return o.delete("/api/book/"+t)};return{getBooks:t,getbookById:e,addBook:r,removeBookById:n}}function userData(){return{userName:"stoneniqiu"}}angular.module("readApp").filter("formatDate",formatDate);function formatDate(){return function(o){var t=new Date(o);var e=t.getDate();var r=["1","2","3","4","5","6","7","8","9","10","11","12"];var n=r[t.getMonth()];var a=t.getFullYear();var i=a+"/"+n+"/"+e;return i}}angular.module("readApp").directive("ratingStars",ratingStars);function ratingStars(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directive/ratingStars/ratingStars.template.html"}}(function(){angular.module("readApp").directive("footerNav",o);function o(){return{restrict:"EA",templateUrl:"/common/directive/footer/footer.html"}}})();(function(){angular.module("readApp").directive("navigation",o);function o(){return{restrict:"EA",templateUrl:"/common/directive/navigation/navigation.html"}}})();(function(){angular.module("readApp").controller("aboutCtrl",o);function o(){var o=this;o.title="<b>ReadingClub</b>";o.user={userName:"stoneniqiu"};o.list=["第一期   《失控》             -- 上海-stoneniqiu","第二期   《代码整洁之道》     -- 上海-stoneniqiu","第三期   《女人的起源》       -- 长沙-素情","第四期   《数学之美》         -- 广州_Watery.D.Lotus","第五期   《卓有成效的管理者》 -- 北京-卡萨布兰卡","第六期   《异类》             -- 上海-stoneniqiu","第七期   《设计心理学》       -- 北京--彦圣","第八期   《乌合之众》         -- 广州_Watery.D.Lotus & 上海_stoneniqiu","第九期   《国富论》           -- 上海-stoneniqiu","第十期   《少有人走的路》     -- 深圳-一路风景","第十一期 《程序员修炼之道》   -- stoneniqiu","第十二期 《性格色彩》         -- 上海_星空"]}})();(function(){angular.module("readApp").controller("booksCtrl",o);o.$inject=["booksData","userData","$modal"];function o(o,t,e){var r=this;r.message="loading...";o.getBooks.success(function(o){r.message=o.length>0?"":"暂无数据";r.books=o}).error(function(o){console.log(o);r.message="Sorry, something's gone wrong "});r.user=t;r.popupForm=function(){var o=e.open({templateUrl:"/bookModal/bookModal.html",controller:"bookModalCtrl as vm",resolve:{viewData:function(){return{title:"新增推荐"}}}});o.result.then(function(o){r.books.push(o)})};r.removeBook=function(t){if(confirm("确定删除？")){o.removeBookById(t).success(function(){for(var o=0;o<r.books.length;o++){if(r.books[o]._id==t){r.books.splice(r.books.indexOf(r.books[o]),1)}}})}}}})();(function(){angular.module("readApp").controller("bookDetailCtrl",o);o.$inject=["$routeParams","booksData","$modal","userData"];function o(o,t,e,r){var n=this;var a=o.bookid;t.getbookById(a).success(function(o){n.book=o}).error(function(o){console.log(o);n.message="Sorry, something's gone wrong "});n.user=r}})();(function(){angular.module("readApp").controller("bookModalCtrl",o);o.$inject=["$modalInstance","viewData","booksData"];function o(o,t,e){var r=this;r.viewData=t;r.onSubmit=function(){r.formError="";if(!r.formData.title||!r.formData.rating||!r.formData.brief||!r.formData.info||!r.formData.ISBN){r.formError="请完成所有栏目!";return false}else{console.log(r.formData);r.doAddBook(r.formData);return false}};r.doAddBook=function(o){e.addBook({title:o.title,info:o.info,ISBN:o.ISBN,brief:o.brief,tags:o.tags,img:o.img,rating:o.rating}).success(function(o){console.log("success!");r.modal.close(o)}).error(function(o){r.formError="添加失败，请再试一次"});return false};r.modal={close:function(t){o.close(t)},cancel:function(){o.dismiss("cancel")}}}})();